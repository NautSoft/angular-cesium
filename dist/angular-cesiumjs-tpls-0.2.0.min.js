/*
 * angular-cesiumjs
 * http://maikuru.github.io/angular-cesiumjs

 * Version: 0.2.0 - 2014-11-04
 * License: Apache-2.0
 */
angular.module("cesiumjs",["cesiumjs.tpls","cesiumjs.cesiumjs","cesiumjs.viewer","cesiumjs.widget"]),angular.module("cesiumjs.tpls",["template/viewer/viewer.html"]),angular.module("cesiumjs",[]).constant("IMAGERY_PROVIDER",{BING:{label:"bing",customLabel:"bing",url:"http://dev.virtualearth.net",ellipsoid:Cesium.Ellipsoid.WGS84,apiKey:null,active:!0,online:!0},BLACK_MARBLE:{label:"blackMarble",customLabel:"blackMarble",url:"http://dev.virtualearth.net",ellipsoid:Cesium.Ellipsoid.WGS84,maximumLevel:8,active:!0,online:!0},NATURAL_EARTH_II:{label:"naturalEarthII",customLabel:"naturalEarthII",url:"bower_components/cesiumjs/Build/Cesium/Assets/Textures/NaturalEarthII",ellipsoid:Cesium.Ellipsoid.WGS84,active:!0,online:!1},WORLDSAT_EARTH:{label:"SeattleMoF",customLabel:"SeattleMoF",url:"http://localhost:8080/geoserver/Seattle.MoF/wms",ellipsoid:Cesium.Ellipsoid.WGS84,active:!0,online:!1}}).constant("SCENE_MODE",{scene2d:Cesium.SceneMode.SCENE2D,scene3d:Cesium.SceneMode.SCENE3D,sceneColumbus:Cesium.SceneMode.COLUMBUS_VIEW}).constant("PIN_COLLECTION_MAKI",{camera:"camera"}),angular.module("cesiumjs.viewer",[]).constant("viewerConfig",{animation:!0,baseLayerPicker:!0,fullscreenButton:!0,geocoder:!0,homeButton:!0,infoBox:!0,sceneModePicker:!0,selectionIndicator:!0,timeline:!0,navigationHelpButton:!0,navigationInstructionsInitiallyVisible:!0,scene3DOnly:!1,useDefaultRenderLoop:!0,targetFrameRate:48,showRenderLoopErrors:!0,automaticallyTrackDataSourceClocks:!0}).controller("ViewerController",function(a,b,c){function d(a,b){e.$element=a;var c=e.$element[0].id||"cesiumViewer";f.cesiumViewer=new Cesium.viewer(c,b)}c.info("viewerController init");var e=this,f=a.$new();this.init=d}).service("CesiumjsViewerService",function(a){a.info("Service Init"),this.viewer=null}).directive("cesiumViewer",function(a,b){return a.info("cesiumViewer called"),{restrict:"EA",controller:"ViewerController",replace:!1,templateUrl:"template/viewer/viewer.html",link:function(c,d,e,f){if(!angular.isDefined(d[0])||""===d[0].id)return void a.error("cesiumViewer: An ID must exist for Cesium to initialize");var g=angular.copy(b);angular.extend(g,c[e.config]),f.init(d,g)}}}),angular.module("cesiumjs.widget",["angular-md5"]).controller("WidgetController",function(a,b,c){var d=this,e=a.$new(),f=a[b.service];this.init=function(a){c.info("WidgetController: init");try{d.$element=a;var b=d.$element[0].id;f.initViewer(b),e.cesiumService=f}catch(g){c.error("WidgetController: failed to initialize"),c.info(f),e.cesiumService=angular.noop}}}).service("CesiumjsWidgetService",function(a,b,c,d,e){b.info("CesiumjsWidgetService: Init");var f={},g=null,h=null,i=null,j=null,k=null,l=null,m=null,n={},o={};this.addMarker=function(a,d,f,g,h,i){b.info("CesiumjsWidgetService: addMarker "+d+" ["+h+","+i+"]"),angular.isDefined(e[d])||b.error("CesiumjsWidgetService: addMarker - invalid marker type = "+d),g=angular.isNumber(g)&&g>5?g:48;var j=Cesium.Color.fromCssColorString(f),k=c.createHash(d+j+g),p=c.createHash(a);angular.isDefined(n[k])?angular.isDefined(o[p])?b.info("CesiumjsWidgetService: addMarker already exists"):(b.info("CesiumjsWidgetService: canvas exists, but not billboard"),o[p]=m.add({image:n[k],verticalOrigin:Cesium.VerticalOrigin.BOTTOM,position:Cesium.Cartesian3.fromDegrees(i,h,0)})):Cesium.when(l.fromMakiIconId(d,j,g),function(a){b.info("CesiumjsWidgetService: addMarker canvas created"),n[k]=a,o[p]=m.add({image:a,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,position:Cesium.Cartesian3.fromDegrees(i,h,0)})})},this.removeMarker=function(a){b.info("CesiumjsWidgetService: removeMarker");var d=c.createHash(a);m.remove(o[d]),delete o[d]},this.removeAllMarkers=function(){m.removeAll(),o={}},this.enableMoon=function(a){h.scene.moon.show=!!a},this.enableSkyBox=function(a){h.scene.skyAtmosphere.show=!!a},this.enableSun=function(a){h.scene.sun.show=!!a},this.enableDebug=function(a){i.debugShowFramesPerSecond=!!a},this.enableDefaultHandlers=function(a){a=!!a,i.screenSpaceCameraController.enableLook=a,i.screenSpaceCameraController.enableTilt=a,i.screenSpaceCameraController.enableZoom=a,i.screenSpaceCameraController.enableRotate=a,i.screenSpaceCameraController.enableTranslate=a},this.generateImageryProvider=function(a){switch(a.label){case d.BING.label:var c=a.apiKey||Cesium.BingMapsApi.defaultKey;Cesium.BingMapsApi.defaultKey=c,f[a.customLabel]=new Cesium.BingMapsImageryProvider({url:a.url,key:c,mapStyle:Cesium.BingMapsStyle.AERIAL});break;case d.BLACK_MARBLE.label:f[a.customLabel]=new Cesium.TileMapServiceImageryProvider({url:a.url,maximumLevel:a.maximumLevel});break;case d.NATURAL_EARTH_II.label:f[a.customLabel]=new Cesium.TileMapServiceImageryProvider({url:a.url});break;case d.WORLDSAT_EARTH.label:b.warn("WORLDSAT not yet implemented");break;default:b.error("no supported image provider:"+a.label)}g||this.setActiveProvider(a.customLabel)},this.generateSkyBox=function(){var a="bower_components/cesiumjs/Build/Cesium/Assets/Textures/SkyBox/tycho2t3_80";return new Cesium.SkyBox({positiveX:a+"_px.jpg",negativeX:a+"_mx.jpg",positiveY:a+"_py.jpg",negativeY:a+"_my.jpg",positiveZ:a+"_pz.jpg",negativeZ:a+"_mz.jpg"})},this.initViewer=function(a){b.info("CesiumjsWidgetService: init Viewer"),h=new Cesium.CesiumWidget(a),i=h.scene,k=i.camera,j=i.primitives,m=j.add(new Cesium.BillboardCollection),l=new Cesium.PinBuilder,i.sun=new Cesium.Sun,i.moon=new Cesium.Moon,i.skyAtmosphere=new Cesium.SkyAtmosphere;var c=f[g],d=c.ellipsoid||Cesium.Ellipsoid.WGS84,e=new Cesium.Globe(d);e.imageryLayers.addImageryProvider(c),e.enableLighting=!0,e.showWaterEffect=!1,j.globe=e},this.isReady=function(){return null!==h},this.setActiveProvider=function(a){angular.isDefined(f[a])&&(g=a)},this.set3DOnly=function(){i.scene3DOnly=!0},this.setSceneMode=function(a,c){switch(c=null===c?!0:!!c,a){case Cesium.SceneMode.SCENE3D:i.morphTo3D();break;case Cesium.SceneMode.SCENE2D:if(i.scene3DOnly)return void b.error('CesiumjsWidgetService: "3D mode only" was set. Cannot change to a 2D mode');i.morphTo2D();break;case Cesium.SceneMode.COLUMBUS_VIEW:if(i.scene3DOnly)return void b.error('CesiumjsWidgetService: "3D mode only" was set. Cannot change to a 2D mode');i.morphToColumbusView();break;default:return void b.error("CesiumjsWidgetService: invalid Screen mode set")}c||i.completeMorph()},this.setCameraPosition=function(a,b,c){k.setPositionCartographic(Cesium.Cartographic.fromDegrees(b,a,c))}}).directive("cesiumWidget",function(a){return{restrict:"EA",controller:"WidgetController",replace:!1,link:function(b,c,d,e){return angular.isDefined(c[0])&&""!==c[0].id?(angular.isDefined(d.service)||a.warn("cesiumWidget: no service to control cesium was provided"),void e.init(c)):void a.error("cesiumWidget: An ID must exist for Cesium to initialize")}}}),angular.module("template/viewer/viewer.html",[]).run(["$templateCache",function(a){a.put("template/viewer/viewer.html",'<div class="cesium-viewer" ng-transclude></div>')}]);